<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Qlik Sense Mashup</title>
	<meta charset="utf-8">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta http-equiv="cleartype" content="on">
	<style>
	.flex-container {
		display: flex;
		flex-wrap: wrap;
		margin: 0 45px 45px 0;
	}

	.qvplaceholder, .qvobject {
		flex: 1 1 auto;
		height: 300px;
		min-width: 400px;
		margin: 45px 0 0 45px;
	}
	</style>	
	<script type="text/javascript">
		const servernameprefix = "https://qserver/jwt";
		function login() {
		  function isLoggedIn() {
			return fetch(servernameprefix+"/qrs/about?xrfkey=0000000000000000", {
			  method: 'GET',
			  mode: 'cors',
			  credentials: 'include',
			  headers: {
				'Content-Type': 'application/json',
				'X-Qlik-xrfkey': '0000000000000000',
				'Authorization': 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySWQiOiJxdXNlciIsIlVzZXJEaXJlY3RvcnkiOiJRU0VSVkVSIn0.Z6HpzD8tkNArzLVJ24RuHsKqhdvHmdes9eyktC81AnX0O6opdduWFR3uVvrF6sXQG21xdoQTpR0UK_XsW3EuAL8HGh82vIMGrvZ_aWPLjWpgdOprenSBxrlZLt27_VBKwYyeNMoY8CdrMcgWxnqzndoLNZnGfPdac-AIqQXZI83-7irJ_mSrUI9j59d9N2z8laF_PrjhWjH-3adKTqwkv8AA7nkJRS-u2hCLtHQqm_FZYno4OxDAxHuI8sAcBGU4BqbkWov0cbXlZ12UyAWGB7lBcFkiTT060kpIy9XFq2xiMTyk-dGVZVJgnpREfjvyaWgtLrFS-ddnaKh5y0UjHA',
			  },
			}).then(response => {
			  return response.status === 200;
			});
		  }
		  return isLoggedIn().then(loggedIn => {
			if (!loggedIn) {
			  alert('You are not logged in');      
			}else{
				//load qlik-styles.css
				var style1 = document.createElement("link");  // create a link DOM node
				style1.type = "text/css";
				style1.rel = "stylesheet";
				style1.href = servernameprefix+"/resources/autogenerated/qlik-styles.css";
				document.head.appendChild(style1);
				
				//load requirejs
				var script = document.createElement("script");  // create a script DOM node
				script.async=false; //this is to ensure that requirejs is loaded before jwtsample.js otherwise it will fail.
				script.defer=false;
				script.src=servernameprefix+"/resources/assets/external/requirejs/require.js";
				document.head.appendChild(script);

				//load the mashup js file
				var script2 = document.createElement("script");  // create a script DOM node
				script2.async=false;
				script2.defer=false;
				script2.src="jwtsample.js";
				document.head.appendChild(script2);
			}
		  });
		}
		login()
	  </script>
</head>
<body style="overflow: auto">
<div class="flex-container">
	<div id="QV01" class="qvplaceholder"></div>
	<div id="QV02" class="qvplaceholder"></div>
	<div id="QV03" class="qvplaceholder"></div>
</div>
</body>
</html>
